#define _EXTERN_

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#include "obus/oi_misc.h"
#include "obus/oi_str.h"
#include "obus/common.h"
#include <assert.h>


#define PROC_DIR	"/proc"

char* get_val2(char* desc, char* src);

int g_iTerminate=0;

int WritePid(char* sPidFilePath)
{
FILE *pPidFile;

	if ((pPidFile = fopen(sPidFilePath, "w")) == NULL) return -1;
	fprintf(pPidFile,"%d",getpid());
	fclose(pPidFile);
	return 0;
}

void DaemonInit()
{
  int fd;

   // shield some signals
   signal(SIGALRM, SIG_IGN);
   signal(SIGINT,  SIG_IGN);
   signal(SIGHUP,  SIG_IGN);
   signal(SIGQUIT, SIG_IGN);
   signal(SIGPIPE, SIG_IGN);
   signal(SIGTTOU, SIG_IGN);
   signal(SIGTTIN, SIG_IGN);
   signal(SIGCHLD, SIG_IGN);
   signal(SIGTERM, SIG_IGN);

   // fork child process
   if (fork()) exit(0);

   // creates  a new session
	if (setsid() == -1)  exit(1);

	// If you needn't STDIN,STDOUT,STDERR, close fd from 0;
	for(fd=3;fd<NOFILE;fd++) close(fd);
	chdir("/");
	umask(0);
	return;
}

void DaemonInit1()
{
  int fd;

   // shield some signals
   signal(SIGALRM, SIG_IGN);
   signal(SIGINT,  SIG_IGN);
   signal(SIGHUP,  SIG_IGN);
   signal(SIGQUIT, SIG_IGN);
   signal(SIGPIPE, SIG_IGN);
   signal(SIGTTOU, SIG_IGN);
   signal(SIGTTIN, SIG_IGN);
   signal(SIGCHLD, SIG_IGN);

   // fork child process
   if (fork()) exit(0);

   // creates  a new session
	if (setsid() == -1)  exit(1);

	// If you needn't STDIN,STDOUT,STDERR, close fd from 0;
	for(fd=3;fd<NOFILE;fd++) close(fd);
	umask(0);
	return;
}

char *ShortDateTimeStr(time_t *mytime)
{
	static char s[50];
	struct tm curr;
	
	curr = *localtime(mytime);

	if (curr.tm_year > 50)
	{
		sprintf(s, "%04d-%02d-%02d-%02d-%02d-%02d", 
					curr.tm_year+1900, curr.tm_mon+1, curr.tm_mday,
					curr.tm_hour, curr.tm_min, curr.tm_sec);
	}
	else
	{
		sprintf(s, "%04d-%02d-%02d-%02d-%02d-%02d", 
					curr.tm_year+2000, curr.tm_mon+1, curr.tm_mday,
					curr.tm_hour, curr.tm_min, curr.tm_sec);
	}
				
	return s;
}

char *CompactDateTimeStr(time_t mytime)
{
	static char s[30];
	struct tm *curr;
	
	curr = localtime(&mytime);
	sprintf(s, "%04d%02d%02d%02d%02d%02d", 
				curr->tm_year+1900, curr->tm_mon+1, curr->tm_mday,
				curr->tm_hour, curr->tm_min, curr->tm_sec);
	return s;
}

/* CDT means CompactDateTimeStr */
time_t CDT2time_t(char *cdt)
{
	assert(NULL != cdt);
	
	if (14 != strlen(cdt))
		return -1;

	char s[8];
	struct tm tran;

	s[0] = cdt[0];	s[1] = cdt[1];	s[2] = cdt[2];	s[3] = cdt[3];	s[4] = '\0';
	tran.tm_year = atoi(s) - 1900;

	s[0] = cdt[4];	s[1] = cdt[5];	s[2] = '\0';
	tran.tm_mon	= atoi(s) - 1;

	s[0] = cdt[6];	s[1] = cdt[7];	s[2] = '\0';
	tran.tm_mday	= atoi(s);

	s[0] = cdt[8];	s[1] = cdt[9];	s[2] = '\0';
	tran.tm_hour	= atoi(s);

	s[0] = cdt[10];	s[1] = cdt[11]; s[2] = '\0';
	tran.tm_min	= atoi(s);

	s[0] = cdt[12];	s[1] = cdt[13]; s[2] = '\0';
	tran.tm_sec	= atoi(s);
	
	return mktime(&tran);
}

char *CompactDateStr(time_t mytime)
{
	static char s[30];
	struct tm *curr;
	
	curr = localtime(&mytime);
	sprintf(s, "%04d%02d%02d", 
				curr->tm_year+1900, curr->tm_mon+1, curr->tm_mday);
	return s;
}

int IsSameDay(time_t t1, time_t t2)
{
	struct tm curr1;
	struct tm curr2;
	
	localtime_r(&t1, &curr1);
	localtime_r(&t2, &curr2);

	if( curr1.tm_year==curr2.tm_year && curr1.tm_yday==curr2.tm_yday )
		return 1;

	return 0;
}

char *DateTimeStr(time_t *mytime)
{
	static char s[50];
	struct tm curr;
	
	curr = *localtime(mytime);

	if (curr.tm_year > 50)
	{
		sprintf(s, "%04d-%02d-%02d %02d:%02d:%02d", 
					curr.tm_year+1900, curr.tm_mon+1, curr.tm_mday,
					curr.tm_hour, curr.tm_min, curr.tm_sec);
	}
	else
	{
		sprintf(s, "%04d-%02d-%02d %02d:%02d:%02d", 
					curr.tm_year+2000, curr.tm_mon+1, curr.tm_mday,
					curr.tm_hour, curr.tm_min, curr.tm_sec);
	}
				
	return s;
}

char *DayStr(time_t mytime)
{
	static char s[30];
	struct tm *curr;
	
	curr = localtime(&mytime);
	sprintf(s, "%02d%02d", curr->tm_mon+1, curr->tm_mday);
	return s;
}

char *CurrDayStr(void)
{
	time_t	iCurTime;

	time(&iCurTime);
	return DayStr(iCurTime);
}

char *CurrDateTimeStr(void)
{
	time_t	iCurTime;

	time(&iCurTime);
	return DateTimeStr(&iCurTime);
}

char *CurrShortDateTimeStr(void)
{
	time_t	iCurTime;

	time(&iCurTime);
	return ShortDateTimeStr(&iCurTime);
}


time_t GetUnixTime(char *sTimeStr)
{
char *pTime, sTmp[100];
struct tm stTime;
time_t lTime;

	memset(&stTime, 0, sizeof(stTime));

	pTime = sTimeStr;
	get_val2(sTmp, pTime);
	stTime.tm_year = atoi(sTmp) - 1900;
	if (stTime.tm_year < 0) stTime.tm_year = 0;
	get_val2(sTmp, pTime);
	stTime.tm_mon = atoi(sTmp) - 1;
	if (stTime.tm_mon < 0) stTime.tm_mon = 0;
	get_val2(sTmp, pTime);
	stTime.tm_mday = atoi(sTmp);
	get_val2(sTmp, pTime);
	stTime.tm_hour = atoi(sTmp);
	get_val2(sTmp, pTime);
	stTime.tm_min = atoi(sTmp);
	get_val2(sTmp, pTime);
	stTime.tm_sec = atoi(sTmp);	

printf("%d %d %d %d %d %d\n", stTime.tm_year,  stTime.tm_mon, stTime.tm_mday, stTime.tm_hour, stTime.tm_min, stTime.tm_sec);
		
	return mktime(&stTime);
}

/* Time string format :yyyy-mm-dd hh:mm:ss */
long MiscMakeTime(char *szTime )
{
    char sTemp[20] , s1[5] ;
    struct tm tmTime;
    time_t lTime ;
	
    if ( strlen ( szTime ) != 19 ) 
      return 0 ;
    strcpy ( sTemp , szTime ) ;

    sprintf(s1,"%s",&sTemp[17]) ;
    sTemp[16]=0 ;
    tmTime.tm_sec = atoi(s1);

    sprintf(s1,"%s",&sTemp[14]) ;
    sTemp[13]=0 ; 
    tmTime.tm_min = atoi(s1) ; 
    
    sprintf(s1,"%s",&sTemp[11]);
    sTemp[10]=0;
    tmTime.tm_hour=atoi(s1) ;
    
    sprintf(s1,"%s",&sTemp[8]);
    sTemp[7]=0;
    tmTime.tm_mday=atoi(s1) ;
    
    sprintf(s1,"%s",&sTemp[5]);
    sTemp[4]=0;
    tmTime.tm_mon=atoi(s1) -1 ;   
    
    tmTime.tm_year=atoi(sTemp)-1900;
    
    tmTime.tm_isdst=0; //标准时间，非夏令时
    lTime =mktime(&tmTime);	
	
    return lTime ;
}

char* MarkTime(int iFlag, char* sFormat, ...)
{
static struct timeval stStartTv;
char sTmp[30];
static char sStr[sizeof(sTmp) + 30];
struct timeval stCurrTv, *pstAddTv;
va_list ap;
long sec, usec;

	if (iFlag) {
		gettimeofday(&stCurrTv, NULL);
		sec = stCurrTv.tv_sec - stStartTv.tv_sec;
		if ((usec = stCurrTv.tv_usec - stStartTv.tv_usec) < 0) {
			sec--;
			usec += 1000000;
		}
		va_start(ap, sFormat);
		if (iFlag == 3 || iFlag == 4) {
			pstAddTv = va_arg(ap, struct timeval*);
			pstAddTv->tv_sec += sec;
			if ((pstAddTv->tv_usec += usec) > 1000000) {
				pstAddTv->tv_sec++;
				pstAddTv->tv_usec -= 1000000;
			}
		} else if (iFlag == 5) {
			pstAddTv = va_arg(ap, struct timeval*);
			pstAddTv->tv_sec = sec;
			pstAddTv->tv_usec = usec;
			va_end(ap);
			return NULL;
		}
		vsnprintf(sTmp, sizeof(sTmp), sFormat, ap);
		va_end(ap);
		sprintf(sStr, "%s: %dsec %dms %dus", sTmp, sec, usec / 1000, usec % 1000);
		if (iFlag == 1 || iFlag == 3) printf("%s\n", sStr);
	} else {
		gettimeofday(&stStartTv, NULL);
	}
	return sStr;
}


int GetPrpsinfo(pid_t pr_pid, prpsinfo_t* prpsinfo)
{
int fd;
char sFilePath[100];
#ifdef __linux__
char line[255], item[100];
FILE *status_file;
#endif

	sprintf(sFilePath, "%s/%d", PROC_DIR, pr_pid);
	if ((fd = open(sFilePath, O_RDONLY)) < 0) {
		perror(sFilePath);
		return -1;
	}
#ifdef __linux__
	strcat(sFilePath, "/status");
	if ( (status_file=fopen(sFilePath, "r"))==NULL ) {
		// printf("Can not open stauts file:%s\nIgnore........\n",proc_status_file);;
		close(fd);
		return -1;
	}
	strcpy(prpsinfo->pr_fname, "");
	while (!feof(status_file)) {
		memset(line, 0, sizeof(line));
		if (fgets(line, sizeof(line), status_file) == NULL) break;
		get_val(item, line);
		if (!strcmp(item, "Name:")) {
			get_val(item, line);
			strcpy(prpsinfo->pr_fname, item);
			break;
		}
	}


	fclose(status_file);
	close(fd);
	if (!strcmp(prpsinfo->pr_fname, "")) return -1;
	prpsinfo->pr_pid = pr_pid;
#else
		if (ioctl(fd, PIOCPSINFO, prpsinfo) < 0) {
			close(fd);
			return -1;
		}
#endif
	close(fd);
	return 0;
}

int WaitProcExit(int iPid)
{
	int i;

	for (i = 0; i < 20; i++)
	{
		if (kill(iPid, 0) < 0) {
			switch (errno) {
				case ESRCH:
					return 0;
					break;
				case EPERM:
					return -1;
					break;
			}
		}
		usleep(100000);
	}

	return -1;
}

int KillProcByPid(int iPid)
{
	int i;

	for (i = 0; i < 20; i++)
	{
		if (kill(iPid, SIGTERM) < 0) {
			switch (errno) {
				case ESRCH:
				printf("killed.\n");
					return 0;
					break;
				case EPERM:
					return -1;
					break;
			}
		}
		usleep(100000);
	}

	return -1;
}

int KillPrevious(char* sPidFilePath)
{
FILE* pPidFile;
char sPid[10], sMyName[50], sKillName[50];
int i, iPid;
prpsinfo_t prpsinfo;

	if ((pPidFile = fopen(sPidFilePath, "r")) == NULL) {
		perror(sPidFilePath);
		return 0;
	}
	memset(sPid, 0, sizeof(sPid));
	if (!fgets(sPid, sizeof(sPid) - 1, pPidFile)) {
		fclose(pPidFile);
		return -1;
	}
	fclose(pPidFile);
	iPid = atoi(sPid);

	if (GetPrpsinfo(getpid(), &prpsinfo) < 0) return -1;
	memset(sMyName, 0, sizeof(sMyName));
	strncpy(sMyName, prpsinfo.pr_fname, sizeof(sMyName) - 1);

	if (GetPrpsinfo(iPid, &prpsinfo) < 0) return 0;
	memset(sKillName, 0, sizeof(sKillName));
	strncpy(sKillName, prpsinfo.pr_fname, sizeof(sKillName) - 1);

	if (strcmp(sMyName, sKillName)) return 0;
	// if (kill(iPid, SIGKILL)) return -1;

	return KillProcByPid(iPid);
// return 0;
}

int UinToTable(unsigned long lUin)
{
	return lUin % 10;
}

char* HashToIndexTable(char* sBaseTableName, unsigned char c)
{
static char sTableName[80];

	snprintf(sTableName, sizeof(sTableName) - 1, "%s%d", sBaseTableName, c);
	return sTableName;
}

int MsSleep(unsigned long lMs)
{
struct timeval stTv;

	stTv.tv_sec = lMs / 1000;
	stTv.tv_usec = (lMs % 1000) * 1000;
	select(0, NULL, NULL, NULL, &stTv);
	return 0;
}

int FileCopy(char* sFile1, char* sFile2)
{
FILE *pf1, *pf2;
char sBuf[1024*4];
int iBytesRead;

	if (pf1 = fopen(sFile1, "r")) {
		if (pf2 = fopen(sFile2, "w")) {
			while ((iBytesRead = fread(sBuf, 1, sizeof(sBuf), pf1)) > 0) fwrite(sBuf, 1, iBytesRead, pf2);
			fclose(pf1);
			fclose(pf2);
			return 0;
		}
		fclose(pf1);
	}
	return -1;
}


unsigned long GetPrimeNumber(unsigned long iNum)
{
unsigned long i, j;

	for (i=iNum; i<=(unsigned long)0xffffffff; ++i)
	{
		for (j=2; j<iNum; ++j)
			if (i % j == 0)	break;
		if (j == iNum)
			return i;
	}		
	return 0;
}

int CheckCharacter ( char *pszStr )
{
    unsigned char *p ;

    for ( p = pszStr ; *p ; p ++ )
    {
        if ( ( *p >= '0' &&  *p <='9'  ) || (*p >= 'a' && *p <= 'z' ) || ( *p >= 'A' && *p <= 'Z' ) || ( *p == '_' ) )
           continue ;

       if ( *p >= 0x80 )
       {
           if ( !( *p >= 0xa0 && *p <= 0xa9 ) )
           {
               p ++ ;

			   if( *p && (*p<0x30 || *p=='\\') )
					return -1;

               continue ;
           }
       }

       return -1 ;
    }

    return 0 ;
}

/*
* 
*/
int CheckCharacter2(char * pszStr) 
{
	unsigned char *p ;

	for(p = pszStr; *p; p++)
	{
		if( (*p >= '0' &&  *p <= '9') || (*p >= 'a' && *p <= 'z') || (*p >= 'A' && *p <= 'Z') || (*p == '_') )
		{
			continue ; 	
		}

		if(*p <0x20 && *p != 0x0a && *p != 0x0d) //allow '\n'
		{
			return(-1);
		}

		if(*p == 0x22 || *p == 0x27 || *p == 0x3d ||*p == '\\' ) // not ' and " , = 
		{
			return(-1);
		}
		
		if(*p > 0x80)
		{
			if(*(p+1) < 0x30)	//非法汉字或半个汉字
			{
				return(-1);
			}
			else	//合法汉字
			{
				p++;
			}
		}

	}

	return(0);
	
}


//////////////////////
// IP地区相关函数
//////////////////////



//static int iMaxAreaID = 0;
static int iAreaIPInit = 0;
static unsigned long alAreaIP[MAX_AREA_ID+1][1000][2];
static int aiAreaIPTotal[MAX_AREA_ID+1];


//注意本结构内的地区排序需与common.h里的一致!!!
static char asAreaIP[MAX_AREA_ID+1][500][2][20] = {

//reserved
{{"", ""}},

//static char asChinaIP[][2][20]  = {
{{"61.4.64.0", "61.4.79.255"},
{"61.28.0.0", "61.28.63.255"},
{"61.48.0.0", "61.55.255.255"},
{"61.128.0.0", "61.191.255.255"},
{"61.232.0.0", "61.237.255.255"},
{"61.240.0.0", "61.243.255.255"},
{"159.226.0.0", "159.226.255.255"},
{"161.207.0.0", "161.207.255.255"},
{"162.105.0.0", "162.105.255.255"},
{"166.111.0.0", "166.111.255.255"},
{"167.139.0.0", "167.139.255.255"},
{"168.160.0.0", "168.160.255.255"},
{"192.83.122.0", "192.83.122.255"},
{"192.124.154.0", "192.124.154.255"},
{"192.188.170.0", "192.188.170.255"},
{"198.17.7.0", "198.17.7.255"},
{"198.97.132.0", "198.97.132.255"},
{"202.0.110.0", "202.0.110.255"},
{"202.0.160.0", "202.0.179.255"},
{"202.3.77.0", "202.3.77.255"},
{"202.4.128.0", "202.4.159.255"},
{"202.14.88.0", "202.14.88.255"},
{"202.14.235.0", "202.14.238.255"},
{"202.20.120.0", "202.20.120.255"},
{"202.22.248.0", "202.22.255.255"},
{"202.38.0.0", "202.38.15.255"},
{"202.38.64.0", "202.38.138.255"},
{"202.38.140.0", "202.38.147.255"},
{"202.38.149.0", "202.38.156.255"},
{"202.38.158.0", "202.38.161.255"},
{"202.38.164.0", "202.38.177.255"},
{"202.38.184.0", "202.38.255.255"},
{"202.90.0.0", "202.90.3.255"},
{"202.90.252.0", "202.91.3.255"},
{"202.91.128.0", "202.91.131.255"},
{"202.92.0.0", "202.92.3.255"},
{"202.92.252.0", "202.93.3.255"},
{"202.93.252.0", "202.94.31.255"},
{"202.95.0.0", "202.95.31.255"},
{"202.95.252.0", "202.122.7.255"},
{"202.122.32.0", "202.122.39.255"},
{"202.122.128.0", "202.122.128.255"},
{"202.127.0.0", "202.127.7.255"},
{"202.127.12.0", "202.127.31.255"},
{"202.127.40.0", "202.127.63.255"},
{"202.127.128.0", "202.127.167.255"},
{"202.127.192.0", "202.127.255.255"},
{"202.130.0.0", "202.130.31.255"},
{"202.131.208.0", "202.131.223.255"},
{"202.168.160.0", "202.168.175.255"},
{"202.192.0.0", "202.207.255.255"},
{"203.81.16.0", "203.81.31.255"},
{"203.87.224.0", "203.88.3.255"},
{"203.89.0.0", "203.89.3.255"},
{"203.90.0.0", "203.90.3.255"},
{"203.91.0.0", "203.91.3.255"},
{"203.92.0.0", "203.92.3.255"},
{"203.93.0.0", "203.94.31.255"},
{"203.128.128.0", "203.128.159.255"},
{"203.175.192.0", "203.175.255.255"},
{"203.192.0.0", "203.192.31.255"},
{"203.196.0.0", "203.196.7.255"},
{"203.207.64.0", "203.208.19.255"},
{"203.212.0.0", "203.212.15.255"},
{"203.222.192.0", "203.222.207.255"},
{"203.223.0.0", "203.223.15.255"},
{"210.5.0.0", "210.5.31.255"},
{"210.5.128.0", "210.5.143.255"},
{"210.12.0.0", "210.13.255.255"},
{"210.14.160.0", "210.15.191.255"},
{"210.21.0.0", "210.22.255.255"},
{"210.25.0.0", "210.47.255.255"},
{"210.51.0.0", "210.53.255.255"},
{"210.72.0.0", "210.78.255.255"},
{"210.79.224.0", "210.79.255.255"},
{"210.82.0.0", "210.83.255.255"},
{"210.192.96.0", "210.192.127.255"},
{"210.211.0.0", "210.211.15.255"},
{"211.64.0.0", "211.71.255.255"},
{"211.80.0.0", "211.103.255.255"},
{"211.136.0.0", "211.167.255.255"},
{"218.0.0.0", "218.31.255.255"},
{"218.56.0.0", "218.99.255.255"},
{"218.104.0.0", "218.109.255.255"},
{"218.192.0.0", "218.205.255.255"},
{"218.240.0.0", "218.247.255.255"},
{"219.72.0.0", "219.72.255.255"},
{"219.128.0.0", "219.159.255.255"},
{"219.216.0.0", "219.220.255.255"},
{"219.222.0.0", "219.223.255.255"},
{"219.232.0.0", "219.237.255.255"},
{"219.242.0.0", "219.247.255.255"},
{"220.112.0.0", "220.115.255.255"},
{"220.160.0.0", "220.207.255.255"},
{"221.0.0.0", "221.7.95.255"},
{"221.7.128.0", "221.11.223.255"},
{"221.12.0.0", "221.12.191.255"},
{"", ""}},


//static char asJapanIP[][2][20]  = {
{{"43.0.0.0", "43.255.255.255"},
{"61.4.128.0", "61.4.175.255"},
{"61.7.0.0", "61.7.63.255"},
{"61.21.0.0", "61.22.159.255"},
{"61.24.0.0", "61.27.143.255"},
{"61.86.0.0", "61.86.255.255"},
{"61.112.0.0", "61.127.255.255"},
{"61.192.0.0", "61.215.255.255"},
{"129.60.0.0", "129.60.255.255"},
{"129.136.0.0", "129.136.255.255"},
{"129.249.0.0", "129.249.255.255"},
{"130.34.0.0", "130.34.255.255"},
{"130.54.0.0", "130.54.255.255"},
{"130.69.0.0", "130.69.255.255"},
{"130.87.0.0", "130.87.255.255"},
{"130.153.0.0", "130.153.255.255"},
{"130.158.0.0", "130.158.255.255"},
{"131.36.0.0", "131.36.255.255"},
{"131.112.0.0", "131.113.255.255"},
{"131.206.0.0", "131.206.255.255"},
{"131.248.0.0", "131.248.255.255"},
{"132.179.0.0", "132.179.255.255"},
{"132.182.0.0", "132.182.255.255"},
{"132.222.0.0", "132.222.255.255"},
{"133.0.0.0", "133.255.255.255"},
{"134.160.0.0", "134.160.255.255"},
{"134.180.0.0", "134.180.255.255"},
{"134.237.0.0", "134.237.255.255"},
{"136.187.0.0", "136.187.255.255"},
{"136.198.0.0", "136.198.255.255"},
{"137.153.0.0", "137.153.255.255"},
{"138.30.0.0", "138.30.255.255"},
{"138.101.0.0", "138.101.255.255"},
{"138.107.0.0", "138.107.255.255"},
{"138.153.0.0", "138.153.255.255"},
{"138.212.0.0", "138.213.255.255"},
{"138.243.0.0", "138.243.255.255"},
{"139.152.0.0", "139.152.255.255"},
{"139.154.0.0", "139.154.255.255"},
{"140.81.0.0", "140.81.255.255"},
{"141.178.0.0", "141.178.255.255"},
{"141.229.0.0", "141.229.255.255"},
{"143.90.0.0", "143.90.255.255"},
{"143.94.0.0", "143.94.255.255"},
{"143.125.0.0", "143.125.255.255"},
{"143.171.0.0", "143.171.255.255"},
{"143.201.0.0", "143.201.255.255"},
{"143.221.0.0", "143.221.255.255"},
{"143.253.0.0", "143.253.255.255"},
{"144.1.0.0", "144.1.255.255"},
{"144.213.0.0", "144.213.255.255"},
{"146.51.0.0", "146.51.255.255"},
{"146.56.0.0", "146.56.255.255"},
{"146.90.0.0", "146.90.255.255"},
{"146.117.0.0", "146.117.255.255"},
{"147.60.0.0", "147.60.255.255"},
{"147.157.0.0", "147.157.255.255"},
{"147.176.0.0", "147.176.255.255"},
{"148.161.0.0", "148.161.255.255"},
{"150.1.0.0", "150.100.255.255"},
{"151.158.0.0", "151.158.255.255"},
{"151.172.0.0", "151.172.255.255"},
{"154.33.0.0", "154.34.255.255"},
{"155.160.0.0", "155.160.255.255"},
{"157.1.0.0", "157.14.255.255"},
{"157.16.0.0", "157.20.255.255"},
{"157.63.0.0", "157.82.255.255"},
{"157.101.0.0", "157.120.255.255"},
{"157.192.0.0", "157.192.255.255"},
{"157.205.0.0", "157.205.255.255"},
{"158.198.0.0", "158.217.255.255"},
{"159.80.0.0", "159.80.255.255"},
{"159.211.0.0", "159.211.255.255"},
{"159.228.0.0", "159.228.255.255"},
{"160.11.0.0", "160.30.255.255"},
{"160.74.0.0", "160.74.255.255"},
{"160.185.0.0", "160.204.255.255"},
{"160.215.0.0", "160.215.255.255"},
{"160.233.0.0", "160.252.255.255"},
{"161.75.0.0", "161.75.255.255"},
{"161.93.0.0", "161.96.255.255"},
{"161.118.0.0", "161.118.255.255"},
{"161.248.0.0", "161.248.255.255"},
{"162.4.0.0", "162.4.255.255"},
{"163.42.0.0", "163.61.255.255"},
{"163.130.0.0", "163.149.255.255"},
{"163.208.0.0", "163.212.255.255"},
{"163.214.0.0", "163.221.255.255"},
{"163.223.0.0", "163.227.255.255"},
{"164.43.0.0", "164.43.255.255"},
{"164.46.0.0", "164.46.255.255"},
{"164.69.0.0", "164.71.255.255"},
{"164.160.0.0", "164.163.255.255"},
{"165.14.0.0", "165.18.255.255"},
{"165.76.0.0", "165.76.255.255"},
{"165.93.0.0", "165.93.255.255"},
{"165.96.0.0", "165.96.255.255"},
{"165.99.0.0", "165.102.255.255"},
{"165.108.0.0", "165.108.255.255"},
{"165.241.0.0", "165.242.255.255"},
{"166.100.0.0", "166.100.255.255"},
{"166.118.0.0", "166.119.255.255"},
{"167.169.0.0", "167.169.255.255"},
{"168.79.0.0", "168.79.255.255"},
{"192.5.216.0", "192.5.216.255"},
{"192.16.178.0", "192.16.179.255"},
{"192.26.9.0", "192.26.9.255"},
{"192.26.91.0", "192.26.91.255"},
{"192.26.93.0", "192.26.94.255"},
{"192.26.96.0", "192.26.96.255"},
{"192.31.116.0", "192.31.124.255"},
{"192.31.197.0", "192.31.206.255"},
{"192.33.135.0", "192.33.135.255"},
{"192.41.178.0", "192.41.197.255"},
{"192.42.84.0", "192.42.86.255"},
{"192.42.103.0", "192.42.107.255"},
{"192.42.237.0", "192.42.237.255"},
{"192.43.174.0", "192.43.174.255"},
{"192.43.189.0", "192.43.189.255"},
{"192.43.201.0", "192.43.202.255"},
{"192.43.224.0", "192.43.224.255"},
{"192.47.0.0", "192.47.241.255"},
{"192.50.0.0", "192.50.255.255"},
{"192.51.16.0", "192.51.255.255"},
{"192.52.119.0", "192.52.150.255"},
{"192.54.247.0", "192.54.247.255"},
{"192.55.110.0", "192.55.110.255"},
{"192.55.118.0", "192.55.118.255"},
{"192.55.220.0", "192.55.220.255"},
{"192.55.238.0", "192.55.238.255"},
{"192.58.9.0", "192.58.18.255"},
{"192.58.97.0", "192.58.101.255"},
{"192.67.70.0", "192.67.70.255"},
{"192.68.110.0", "192.68.111.255"},
{"192.68.235.0", "192.68.249.255"},
{"192.70.179.0", "192.70.183.255"},
{"192.76.252.0", "192.76.254.255"},
{"192.82.132.0", "192.82.132.255"},
{"192.83.104.0", "192.83.104.255"},
{"192.83.157.0", "192.83.157.255"},
{"192.83.217.0", "192.83.219.255"},
{"192.84.71.0", "192.84.73.255"},
{"192.88.80.0", "192.88.80.255"},
{"192.88.101.0", "192.88.102.255"},
{"192.94.220.0", "192.94.220.255"},
{"192.94.238.0", "192.94.238.255"},
{"192.103.42.0", "192.103.43.255"},
{"192.104.40.0", "192.104.40.255"},
{"192.104.80.0", "192.104.80.255"},
{"192.104.172.0", "192.104.172.255"},
{"192.104.232.0", "192.104.233.255"},
{"192.104.246.0", "192.104.247.255"},
{"192.132.8.0", "192.132.8.255"},
{"192.132.31.0", "192.132.31.255"},
{"192.133.47.0", "192.133.47.255"},
{"192.135.89.0", "192.135.108.255"},
{"192.135.222.0", "192.135.222.255"},
{"192.146.184.0", "192.146.184.255"},
{"192.149.209.0", "192.149.209.255"},
{"192.152.69.0", "192.152.69.255"},
{"192.152.212.0", "192.152.212.255"},
{"192.153.6.0", "192.153.6.255"},
{"192.153.95.0", "192.153.114.255"},
{"192.156.140.0", "192.156.159.255"},
{"192.156.220.0", "192.156.220.255"},
{"192.160.161.0", "192.160.161.255"},
{"192.172.227.0", "192.172.228.255"},
{"192.172.232.0", "192.172.246.255"},
{"192.174.128.0", "192.174.255.255"},
{"192.188.73.0", "192.188.92.255"},
{"192.189.24.0", "192.189.24.255"},
{"192.218.0.0", "192.218.255.255"},
{"192.234.58.0", "192.234.58.255"},
{"192.244.0.0", "192.244.255.255"},
{"198.17.1.0", "198.17.1.255"},
{"198.17.118.0", "198.17.118.255"},
{"198.49.232.0", "198.49.232.255"},
{"198.49.240.0", "198.49.240.255"},
{"198.178.188.0", "198.178.188.255"},
{"199.103.103.0", "199.103.103.255"},
{"202.0.65.0", "202.0.66.255"},
{"202.0.72.0", "202.0.73.255"},
{"202.0.76.0", "202.0.76.255"},
{"202.0.93.0", "202.0.93.255"},
{"202.2.88.0", "202.2.91.255"},
{"202.3.136.0", "202.3.136.255"},
{"202.3.140.0", "202.3.143.255"},
{"202.6.98.0", "202.6.98.255"},
{"202.6.103.0", "202.6.103.255"},
{"202.8.6.0", "202.8.7.255"},
{"202.10.96.0", "202.10.111.255"},
{"202.11.0.0", "202.11.255.255"},
{"202.12.8.0", "202.12.15.255"},
{"202.13.0.0", "202.13.254.255"},
{"202.15.0.0", "202.19.255.255"},
{"202.20.90.0", "202.20.90.255"},
{"202.20.110.0", "202.20.110.255"},
{"202.20.123.0", "202.20.124.255"},
{"202.21.112.0", "202.21.127.255"},
{"202.21.150.0", "202.21.153.255"},
{"202.21.160.0", "202.21.175.255"},
{"202.22.64.0", "202.22.127.255"},
{"202.23.0.0", "202.26.255.255"},
{"202.32.0.0", "202.35.255.255"},
{"202.48.0.0", "202.48.255.255"},
{"202.83.128.0", "202.83.159.255"},
{"202.95.160.0", "202.95.175.255"},
{"202.126.224.0", "202.126.239.255"},
{"202.140.0.0", "202.140.31.255"},
{"202.146.160.0", "202.146.191.255"},
{"202.157.96.0", "202.157.127.255"},
{"202.176.0.32", "202.176.2.143"},
{"202.176.3.0", "202.176.3.255"},
{"202.208.0.0", "202.255.255.255"},
{"203.82.128.0", "203.82.159.255"},
{"203.104.96.0", "203.104.111.255"},
{"203.104.128.0", "203.104.255.255"},
{"203.131.192.0", "203.131.207.255"},
{"203.136.0.0", "203.141.255.255"},
{"203.165.0.0", "203.165.255.255"},
{"203.173.64.0", "203.173.79.255"},
{"203.174.64.0", "203.174.79.255"},
{"203.178.0.0", "203.183.255.255"},
{"203.192.128.0", "203.192.191.255"},
{"203.194.64.0", "203.194.95.255"},
{"203.205.0.0", "203.205.111.255"},
{"203.205.128.0", "203.205.191.255"},
{"203.216.0.0", "203.216.159.255"},
{"203.223.64.0", "203.223.79.255"},
{"204.79.157.0", "204.79.158.255"},
{"204.79.218.0", "204.79.218.255"},
{"204.231.230.0", "204.231.230.255"},
{"204.231.251.0", "204.231.252.255"},
{"206.3.0.0", "206.3.31.255"},
{"206.143.128.0", "206.143.255.255"},
{"210.2.0.0", "210.2.255.255"},
{"210.20.0.0", "210.20.255.255"},
{"210.79.0.0", "210.79.15.255"},
{"210.80.192.0", "210.81.255.255"},
{"210.88.0.0", "210.89.31.255"},
{"210.128.0.0", "210.175.255.255"},
{"210.185.128.0", "210.185.159.255"},
{"210.188.0.0", "210.191.255.255"},
{"210.194.0.0", "210.194.255.255"},
{"210.196.0.0", "210.199.255.255"},
{"210.224.0.0", "210.239.255.255"},
{"210.248.0.0", "211.19.255.255"},
{"211.120.0.0", "211.135.255.255"},
{"218.40.0.0", "218.47.255.255"},
{"218.110.0.0", "218.110.255.255"},
{"218.112.0.0", "218.143.255.255"},
{"218.176.0.0", "218.183.255.255"},
{"218.216.0.0", "218.231.255.255"},
{"219.0.0.0", "219.63.255.255"},
{"219.96.0.0", "219.127.255.255"},
{"219.160.0.0", "219.215.255.255"},
{"220.0.0.0", "220.63.255.255"},
{"220.96.0.0", "220.99.255.255"},
{"220.144.0.0", "220.145.255.255"},
{"220.208.0.0", "220.223.255.255"},
{"220.254.0.0", "220.254.127.255"},
{"221.16.0.0", "221.119.255.255"},
{"", ""}},


//static char asIndonesiaIP[][2][20]  = {
{{"61.5.0.0", "61.5.127.255"},
{"61.5.192.0", "61.5.207.255"},
{"61.94.0.0", "61.94.255.255"},
{"141.103.0.0", "141.103.255.255"},
{"152.118.0.0", "152.118.255.255"},
{"167.205.0.0", "167.205.255.255"},
{"192.41.206.0", "192.41.206.255"},
{"192.73.24.0", "192.73.25.255"},
{"192.188.175.0", "192.188.175.255"},
{"198.51.101.0", "198.51.101.255"},
{"202.0.81.0", "202.0.81.255"},
{"202.0.103.0", "202.0.103.255"},
{"202.0.116.0", "202.0.116.255"},
{"202.3.192.0", "202.3.207.255"},
{"202.20.106.0", "202.20.109.255"},
{"202.43.160.0", "202.43.191.255"},
{"202.43.248.0", "202.43.255.255"},
{"202.46.0.0", "202.46.18.255"},
{"202.46.20.0", "202.46.21.255"},
{"202.46.24.0", "202.46.31.255"},
{"202.46.64.0", "202.46.111.255"},
{"202.46.128.0", "202.46.131.255"},
{"202.46.144.0", "202.46.159.255"},
{"202.46.240.0", "202.46.255.255"},
{"202.47.64.0", "202.47.79.255"},
{"202.47.192.0", "202.47.223.255"},
{"202.51.96.0", "202.51.127.255"},
{"202.51.192.0", "202.51.239.255"},
{"202.51.252.0", "202.51.255.255"},
{"202.53.224.0", "202.53.255.255"},
{"202.55.128.0", "202.55.143.255"},
{"202.55.160.0", "202.55.175.255"},
{"202.57.4.0", "202.57.5.255"},
{"202.57.16.0", "202.57.31.255"},
{"202.58.64.0", "202.58.79.255"},
{"202.58.192.0", "202.58.223.255"},
{"202.59.160.0", "202.59.175.255"},
{"202.59.192.0", "202.59.207.255"},
{"202.65.224.0", "202.65.239.255"},
{"202.67.32.0", "202.67.47.255"},
{"202.69.96.0", "202.69.111.255"},
{"202.70.48.0", "202.70.63.255"},
{"202.72.32.0", "202.72.47.255"},
{"202.72.192.0", "202.72.207.255"},
{"202.72.224.0", "202.72.239.255"},
{"202.73.16.0", "202.73.31.255"},
{"202.73.96.0", "202.73.127.255"},
{"202.73.224.0", "202.73.239.255"},
{"202.75.16.0", "202.75.31.255"},
{"202.75.96.0", "202.75.111.255"},
{"202.77.64.0", "202.77.79.255"},
{"202.77.96.0", "202.77.127.255"},
{"202.81.32.0", "202.81.63.255"},
{"202.87.192.0", "202.87.207.255"},
{"202.92.192.0", "202.92.207.255"},
{"202.93.32.0", "202.93.47.255"},
{"202.95.128.0", "202.95.159.255"},
{"202.123.224.0", "202.123.239.255"},
{"202.127.96.0", "202.127.111.255"},
{"202.134.0.0", "202.134.3.255"},
{"202.136.64.0", "202.136.95.255"},
{"202.137.0.0", "202.137.31.255"},
{"202.138.224.0", "202.138.255.255"},
{"202.143.32.0", "202.143.63.255"},
{"202.143.96.0", "202.143.111.255"},
{"202.145.0.0", "202.145.15.255"},
{"202.146.0.0", "202.146.3.255"},
{"202.146.32.0", "202.146.63.255"},
{"202.146.128.0", "202.146.159.255"},
{"202.146.224.0", "202.146.255.255"},
{"202.147.192.0", "202.147.207.255"},
{"202.147.224.0", "202.148.63.255"},
{"202.149.0.0", "202.149.31.255"},
{"202.149.64.0", "202.149.95.255"},
{"202.149.128.0", "202.149.159.255"},
{"202.149.240.0", "202.150.15.255"},
{"202.150.32.0", "202.150.47.255"},
{"202.150.64.0", "202.150.95.255"},
{"202.150.128.0", "202.150.175.255"},
{"202.150.224.0", "202.151.3.255"},
{"202.151.32.0", "202.151.32.255"},
{"202.152.0.0", "202.152.63.255"},
{"202.152.128.0", "202.152.175.255"},
{"202.152.192.0", "202.152.207.255"},
{"202.152.224.0", "202.152.255.255"},
{"202.153.128.0", "202.153.159.255"},
{"202.153.224.0", "202.154.63.255"},
{"202.155.0.0", "202.155.159.255"},
{"202.157.0.0", "202.157.1.255"},
{"202.158.0.0", "202.158.143.255"},
{"202.159.0.0", "202.159.127.255"},
{"202.162.32.0", "202.162.47.255"},
{"202.162.192.0", "202.162.223.255"},
{"202.164.0.0", "202.164.31.255"},
{"202.165.32.0", "202.165.47.255"},
{"202.169.32.0", "202.169.63.255"},
{"202.169.224.0", "202.169.239.255"},
{"202.170.224.0", "202.171.15.255"},
{"202.173.64.0", "202.173.95.255"},
{"202.180.0.0", "202.180.31.255"},
{"202.183.0.0", "202.183.31.255"},
{"203.77.224.0", "203.77.255.255"},
{"203.83.32.0", "203.83.47.255"},
{"203.99.96.0", "203.99.127.255"},
{"203.109.0.0", "203.109.31.255"},
{"203.112.64.0", "203.112.79.255"},
{"203.128.64.0", "203.128.95.255"},
{"203.130.192.0", "203.130.255.255"},
{"203.153.0.0", "203.153.3.255"},
{"210.23.64.0", "210.23.79.255"},
{"", ""}},


//static char asTailandIP[][2][20]  = {
{{"61.11.224.0", "61.11.255.255"},
{"157.179.0.0", "157.179.255.255"},
{"158.108.0.0", "158.108.255.255"},
{"161.200.0.0", "161.200.255.255"},
{"161.246.0.0", "161.246.255.255"},
{"164.115.0.0", "164.115.255.255"},
{"165.209.0.0", "165.209.255.255"},
{"168.120.0.0", "168.120.255.255"},
{"192.41.170.0", "192.41.170.255"},
{"192.100.77.0", "192.100.77.255"},
{"192.101.91.0", "192.101.91.255"},
{"192.102.83.0", "192.102.83.255"},
{"192.108.230.0", "192.108.230.255"},
{"192.133.10.0", "192.133.10.255"},
{"192.150.249.0", "192.150.251.255"},
{"192.188.172.0", "192.188.172.255"},
{"192.203.247.0", "192.203.247.255"},
{"192.207.64.0", "192.207.64.255"},
{"192.207.242.0", "192.207.242.255"},
{"192.207.254.0", "192.207.254.255"},
{"192.251.227.0", "192.251.228.255"},
{"198.22.35.0", "198.22.35.255"},
{"198.49.112.0", "198.49.113.255"},
{"202.0.79.0", "202.0.79.255"},
{"202.0.111.0", "202.0.111.255"},
{"202.0.117.0", "202.0.120.255"},
{"202.3.68.0", "202.3.71.255"},
{"202.6.90.0", "202.6.90.255"},
{"202.6.100.0", "202.6.101.255"},
{"202.6.107.0", "202.6.107.255"},
{"202.6.111.0", "202.6.111.255"},
{"202.8.64.0", "202.8.75.255"},
{"202.12.73.0", "202.12.74.255"},
{"202.12.97.0", "202.12.97.255"},
{"202.12.116.0", "202.12.116.255"},
{"202.14.90.0", "202.14.94.255"},
{"202.14.117.0", "202.14.117.255"},
{"202.14.162.0", "202.14.164.255"},
{"202.20.67.0", "202.20.68.255"},
{"202.20.87.0", "202.20.87.255"},
{"202.20.105.0", "202.20.105.255"},
{"202.21.134.0", "202.21.135.255"},
{"202.21.140.0", "202.21.140.255"},
{"202.21.144.0", "202.21.144.255"},
{"202.21.149.0", "202.21.149.255"},
{"202.22.8.0", "202.22.15.255"},
{"202.22.32.0", "202.22.63.255"},
{"202.28.0.0", "202.29.255.255"},
{"202.44.0.0", "202.44.51.255"},
{"202.44.60.0", "202.44.74.255"},
{"202.44.96.0", "202.44.96.255"},
{"202.44.128.0", "202.44.151.255"},
{"202.44.192.0", "202.44.196.255"},
{"202.44.200.0", "202.44.255.255"},
{"202.47.224.0", "202.47.255.255"},
{"202.57.128.0", "202.57.191.255"},
{"202.59.224.0", "202.59.255.255"},
{"202.60.192.0", "202.60.207.255"},
{"202.74.32.0", "202.74.63.255"},
{"202.80.224.0", "202.80.255.255"},
{"202.125.96.0", "202.125.111.255"},
{"202.129.0.0", "202.129.63.255"},
{"202.133.128.0", "202.133.191.255"},
{"202.153.0.0", "202.153.3.255"},
{"202.182.0.0", "202.182.31.255"},
{"202.183.128.0", "202.183.255.255"},
{"203.78.96.0", "203.78.111.255"},
{"203.101.128.0", "203.101.159.255"},
{"203.107.128.0", "203.107.255.255"},
{"203.113.0.0", "203.113.95.255"},
{"203.114.224.0", "203.114.255.255"},
{"203.118.64.0", "203.118.95.255"},
{"203.121.128.0", "203.121.191.255"},
{"203.130.128.0", "203.130.159.255"},
{"203.144.128.0", "203.145.31.255"},
{"203.146.0.0", "203.147.63.255"},
{"203.148.128.0", "203.149.63.255"},
{"203.150.0.0", "203.151.255.255"},
{"203.153.128.0", "203.153.143.255"},
{"203.154.0.0", "203.156.63.255"},
{"203.157.0.0", "203.158.7.255"},
{"203.158.96.0", "203.159.255.255"},
{"203.170.128.0", "203.170.255.255"},
{"203.172.32.0", "203.172.127.255"},
{"203.185.64.0", "203.185.159.255"},
{"203.192.32.0", "203.192.63.255"},
{"203.209.0.0", "203.209.63.255"},
{"210.1.0.0", "210.1.63.255"},
{"210.4.128.0", "210.4.159.255"},
{"210.203.128.0", "210.203.191.255"},
{"", ""}},


//static char asTaiwanIP[][2][20]  = {
{{"61.13.0.0", "61.13.255.255"},
{"61.16.0.0", "61.16.127.255"},
{"61.20.0.0", "61.20.255.255"},
{"61.30.0.0", "61.31.255.255"},
{"61.56.0.0", "61.67.255.255"},
{"61.70.0.0", "61.71.255.255"},
{"61.216.0.0", "61.231.255.255"},
{"133.223.0.0", "133.223.255.255"},
{"134.208.0.0", "134.208.255.255"},
{"139.175.0.0", "139.170.255.255"},
{"140.92.0.0", "140.92.255.255"},
{"140.96.0.0", "140.96.255.255"},
{"140.109.0.0", "140.109.255.255"},
{"140.112.0.0", "140.112.255.255"},
{"163.25.0.0", "163.25.255.255"},
{"163.28.0.0", "163.28.255.255"},
{"168.95.0.0", "168.95.255.255"},
{"192.188.170.0", "192.188.170.255"},
{"194.117.103.0", "194.117.103.255"},
{"199.107.119.0", "199.107.119.255"},
{"202.2.52.0", "202.2.55.255"},
{"202.3.160.0", "202.3.191.255"},
{"202.4.25.0", "202.4.25.255"},
{"202.5.4.0", "202.5.5.255"},
{"202.5.8.0", "202.5.11.255"},
{"202.5.224.0", "202.5.255.255"},
{"202.8.160.0", "202.8.191.255"},
{"202.14.8.0", "202.14.15.255"},
{"202.39.0.0", "202.39.255.255"},
{"202.43.64.0", "202.43.127.255"},
{"202.52.64.0", "202.52.127.255"},
{"202.55.224.0", "202.55.255.255"},
{"202.60.64.0", "202.60.95.255"},
{"202.61.32.0", "202.61.63.255"},
{"202.80.128.0", "202.80.175.255"},
{"202.90.64.0", "202.90.95.255"},
{"202.94.192.0", "202.94.207.255"},
{"202.129.192.0", "202.129.255.255"},
{"202.130.32.0", "202.130.63.255"},
{"202.132.0.0", "202.132.255.255"},
{"202.133.224.0", "202.133.255.255"},
{"202.143.128.0", "202.143.159.255"},
{"202.145.32.0", "202.145.255.255"},
{"202.154.192.0", "202.154.223.255"},
{"202.159.128.0", "202.159.143.255"},
{"202.160.64.0", "202.160.95.255"},
{"202.162.64.0", "202.162.95.255"},
{"202.165.128.0", "202.165.143.255"},
{"202.166.160.0", "202.166.255.255"},
{"202.167.54.0", "202.167.54.255"},
{"202.167.58.0", "202.167.58.255"},
{"202.167.75.0", "202.167.75.255"},
{"202.167.80.0", "202.167.80.255"},
{"202.167.83.0", "202.167.83.255"}, 
{"202.167.87.0", "202.167.88.255"},
{"202.167.90.0", "202.167.90.255"},
{"202.168.192.0", "202.168.207.255"},
{"202.173.32.0", "202.173.63.255"},
{"202.174.64.0", "202.174.95.255"},
{"202.178.128.0", "202.178.255.255"},
{"203.64.0.0", "203.75.255.255"},
{"203.76.64.0", "203.76.95.255"},
{"203.77.0.0", "203.77.127.255"},
{"203.78.0.0", "203.78.3.255"},
{"203.79.128.0", "203.79.255.255"},
{"203.95.128.0", "203.95.255.255"},
{"203.105.224.0", "203.105.255.255"},
{"203.107.0.0", "203.107.63.255"},
{"203.133.0.0", "203.133.127.255"},
{"203.135.64.0", "203.135.95.255"},
{"203.135.224.0", "203.135.255.255"},
{"203.149.128.0", "203.149.255.255"},
{"203.160.224.0", "203.160.255.255"},
{"203.161.128.0", "203.161.159.255"},
{"203.163.6.0", "203.163.6.255"},
{"203.163.192.0", "203.163.223.255"},
{"203.187.0.0", "203.187.127.255"},
{"203.194.65.0", "203.194.69.255"},
{"203.203.0.0", "203.204.255.255"},
{"203.207.0.0", "203.207.15.255"},
{"203.211.0.0", "203.211.31.255"},
{"203.217.96.0", "203.217.191.255"},
{"210.17.0.0", "210.17.127.255"},
{"210.58.0.0", "210.71.255.255"},
{"210.80.64.0", "210.80.95.255"},
{"210.85.0.0", "210.85.255.255"},
{"210.192.0.0", "210.192.255.255"},
{"210.200.0.0", "210.203.127.255"},
{"210.208.0.0", "210.209.63.255"},
{"210.213.4.0", "210.213.4.255"},
{"210.240.0.0", "210.244.255.255"},
{"211.20.0.0", "211.23.255.255"},
{"211.72.0.0", "211.79.255.255"},
{"218.32.0.0", "218.32.255.255"},
{"218.160.0.0", "218.165.255.255"},
{"218.184.0.0", "218.184.255.255"},
{"218.187.0.0", "218.187.127.255"},
{"219.68.0.0", "219.68.127.255"},
{"219.80.0.0", "219.81.255.255"},
{"219.90.0.0", "219.90.63.255"},
{"", ""}},

	
//static char SouthAfricaIP[][2][20]  = {
{{"66.8.0.0", "66.8.127.255"},
{"66.18.64.0", "66.18.95.255"},
{"137.158.0.0", "137.158.255.255"},
{"137.214.0.0", "137.215.255.255"},
{"139.53.0.0", "139.53.255.255"},
{"143.128.0.0", "143.128.255.255"},
{"143.160.0.0", "143.160.255.255"},
{"146.64.0.0", "146.64.255.255"},
{"146.141.0.0", "146.141.255.255"},
{"146.182.0.0", "146.182.255.255"},
{"146.230.0.0", "146.232.255.255"},
{"147.110.0.0", "147.110.255.255"},
{"152.106.0.0", "152.112.255.255"},
{"155.159.0.0", "155.159.255.255"},
{"155.232.0.0", "155.240.255.255"},
{"156.8.0.0", "156.8.255.255"},
{"160.115.0.0", "160.116.255.255"},
{"160.118.0.0", "160.118.255.255"},
{"160.121.0.0", "160.124.255.255"},
{"163.195.0.0", "163.203.255.255"},
{"164.88.0.0", "164.88.255.255"},
{"164.146.0.0", "164.151.255.255"},
{"164.155.0.0", "164.155.255.255"},
{"165.3.0.0", "165.5.255.255"},
{"165.8.0.0", "165.11.255.255"},
{"165.25.0.0", "165.25.255.255"},
{"165.143.0.0", "165.149.255.255"},
{"165.165.0.0", "165.165.255.255"},
{"165.180.0.0", "165.180.255.255"},
{"165.233.0.0", "165.233.255.255"},
{"166.85.0.0", "166.85.255.255"},
{"168.76.0.0", "168.76.255.255"},
{"168.80.0.0", "168.81.255.255"},
{"168.89.0.0", "168.89.255.255"},
{"168.128.0.0", "168.128.255.255"},
{"168.142.0.0", "168.142.255.255"},
{"168.155.0.0", "168.155.255.255"},
{"168.164.0.0", "168.164.255.255"},
{"168.167.0.0", "168.167.255.255"},
{"168.172.0.0", "168.172.255.255"},
{"168.206.0.0", "168.206.255.255"},
{"168.209.0.0", "168.210.255.255"},
{"169.129.0.0", "169.129.255.255"},
{"169.202.0.0", "169.202.255.255"},
{"192.33.10.0", "192.33.10.255"},
{"192.42.99.0", "192.42.99.255"},
{"192.48.253.0", "192.48.253.255"},
{"192.70.237.0", "192.70.237.255"},
{"192.82.142.0", "192.82.142.255"},
{"192.84.244.0", "192.84.244.255"},
{"192.94.61.0", "192.94.61.255"},
{"192.94.210.0", "192.94.210.255"},
{"192.94.240.0", "192.94.241.255"},
{"192.94.246.0", "192.94.246.255"},
{"192.96.0.0", "192.96.255.255"},
{"192.100.1.0", "192.100.1.255"},
{"192.102.9.0", "192.102.9.255"},
{"192.133.250.0", "192.133.250.255"},
{"192.157.190.0", "192.157.190.255"},
{"192.188.164.0", "192.188.167.255"},
{"192.189.75.0", "192.189.75.255"},
{"192.189.139.0", "192.189.140.255"},
{"192.231.254.0", "192.231.254.255"},
{"196.1.8.0", "196.1.14.255"},
{"196.1.16.0", "196.1.25.255"},
{"196.1.32.0", "196.1.51.255"},
{"196.1.74.0", "196.1.91.255"},
{"196.1.101.0", "196.1.103.255"},
{"196.1.128.0", "196.1.129.255"},
{"196.2.16.0", "196.2.63.255"},
{"196.2.128.0", "196.2.159.255"},
{"196.3.92.0", "196.3.93.255"},
{"196.3.107.0", "196.3.108.255"},
{"196.3.110.0", "196.3.131.255"},
{"196.3.148.0", "196.3.151.255"},
{"196.3.154.0", "196.3.179.255"},
{"196.3.224.0", "196.4.254.255"},
{"196.5.0.0", "196.11.255.255"},
{"196.12.16.0", "196.12.31.255"},
{"196.13.0.0", "196.15.7.255"},
{"196.15.64.0", "196.19.255.255"},
{"196.21.0.0", "196.22.4.255"},
{"196.22.16.0", "196.22.47.255"},
{"196.22.64.0", "196.22.129.255"},
{"196.22.160.0", "196.22.239.255"},
{"196.23.0.0", "196.26.255.255"},
{"196.28.0.0", "196.28.6.255"},
{"196.28.8.0", "196.28.8.255"},
{"196.28.16.0", "196.28.47.255"},
{"196.28.64.0", "196.28.223.255"},
{"196.29.0.0", "196.29.31.255"},
{"196.29.128.0", "196.29.159.255"},
{"196.29.240.0", "196.31.255.255"},
{"196.33.0.0", "196.38.127.255"},
{"196.41.0.0", "196.41.31.255"},
{"196.41.64.0", "196.41.95.255"},
{"196.41.128.0", "196.41.175.255"},
{"196.41.192.0", "196.41.223.255"},
{"196.43.0.0", "196.43.63.255"},
{"196.44.0.0", "196.44.47.255"},
{"196.44.64.0", "196.44.95.255"},
{"196.44.192.0", "196.44.207.255"},
{"196.44.224.0", "196.44.239.255"},
{"198.54.0.0", "198.54.255.255"},
{"200.16.8.0", "200.16.15.255"},
{"204.12.128.0", "204.12.143.255"},
{"204.87.179.0", "204.87.179.255"},
{"204.235.32.0", "204.235.43.255"},
{"205.159.79.0", "205.159.79.255"},
{"206.223.136.0", "206.223.136.255"},
{"209.203.0.0", "209.203.63.255"},
{"209.212.96.0", "209.212.127.255"},
{"", ""}},


//static char asHongKongIP[][2][20]  = {
{{"61.4.0.0", "61.4.63.255"},
{"61.10.0.0", "61.10.255.255"},
{"61.15.0.0", "61.15.255.255"},
{"61.18.0.0", "61.18.255.255"},
{"61.92.0.0", "61.93.255.255"},
{"61.238.0.0", "61.238.255.255"},
{"137.189.0.0", "137.189.255.255"},
{"143.89.0.0", "143.89.255.255"},
{"144.214.0.0", "144.214.255.255"},
{"147.8.0.0", "147.8.255.255"},
{"152.101.0.0", "152.104.255.255"},
{"158.132.0.0", "158.132.255.255"},
{"158.182.0.0", "158.182.255.255"},
{"161.64.0.0", "161.64.255.255"},
{"165.202.0.0", "165.202.255.255"},
{"165.222.0.0", "165.222.255.255"},
{"166.81.0.0", "166.81.255.255"},
{"168.70.0.0", "168.70.255.255"},
{"168.106.0.0", "168.106.255.255"},
{"192.91.254.0", "192.91.254.255"},
{"192.94.174.0", "192.94.174.255"},
{"192.149.239.0", "192.149.239.255"},
{"192.157.162.0", "192.157.162.255"},
{"192.157.191.0", "192.157.191.255"},
{"192.203.183.0", "192.203.185.255"},
{"192.206.102.0", "192.206.102.255"},
{"192.207.91.0", "192.207.91.255"},
{"192.245.155.0", "192.245.155.255"},
{"192.245.196.0", "192.245.196.255"},
{"192.245.208.0", "192.245.208.255"},
{"198.49.2.0", "198.49.2.255"},
{"198.51.99.0", "198.51.99.255"},
{"198.99.173.0", "198.99.173.255"},
{"202.0.77.0", "202.0.78.255"},
{"202.0.100.0", "202.0.100.255"},
{"202.0.104.0", "202.0.104.255"},
{"202.0.112.0", "202.0.112.255"},
{"202.0.122.0", "202.0.123.255"},
{"202.0.128.0", "202.0.147.255"},
{"202.0.181.0", "202.0.183.255"},
{"202.1.6.0", "202.1.7.255"},
{"202.2.32.0", "202.2.51.255"},
{"202.2.64.0", "202.2.87.255"},
{"202.3.6.0", "202.3.7.255"},
{"202.4.26.0", "202.4.27.255"},
{"202.4.192.0", "202.4.223.255"},
{"202.5.16.0", "202.5.31.255"},
{"202.6.0.0", "202.6.1.255"},
{"202.6.192.0", "202.6.207.255"},
{"202.7.128.0", "202.7.143.255"},
{"202.8.93.0", "202.8.93.255"},
{"202.12.4.0", "202.12.7.255"},
{"202.14.67.0", "202.14.68.255"},
{"202.14.80.0", "202.14.80.255"},
{"202.14.222.0", "202.14.222.255"},
{"202.20.66.0", "202.20.66.255"},
{"202.20.88.0", "202.20.89.255"},
{"202.20.94.0", "202.20.95.255"},
{"202.20.98.0", "202.20.98.255"},
{"202.20.100.0", "202.20.101.255"},
{"202.20.111.0", "202.20.111.255"},
{"202.20.117.0", "202.20.118.255"},
{"202.20.125.0", "202.20.127.255"},
{"202.38.16.0", "202.38.31.255"},
{"202.40.0.0", "202.40.5.255"},
{"202.40.7.0", "202.40.162.255"},
{"202.40.164.0", "202.40.171.255"},
{"202.40.192.0", "202.40.223.255"},
{"202.45.0.0", "202.45.2.255"},
{"202.45.4.0", "202.45.5.255"},
{"202.45.8.0", "202.45.9.255"},
{"202.45.15.0", "202.45.95.255"},
{"202.45.128.0", "202.45.128.255"},
{"202.45.160.0", "202.45.255.255"},
{"202.52.128.0", "202.52.159.255"},
{"202.52.192.0", "202.52.223.255"},
{"202.53.128.0", "202.53.159.255"},
{"202.57.192.0", "202.57.223.255"},
{"202.57.252.0", "202.57.255.255"},
{"202.60.32.0", "202.60.63.255"},
{"202.60.224.0", "202.60.255.255"},
{"202.61.96.0", "202.61.127.255"},
{"202.62.192.0", "202.62.223.255"},
{"202.63.0.0", "202.63.31.255"},
{"202.63.128.0", "202.63.159.255"},
{"202.64.0.0", "202.65.9.255"},
{"202.65.96.0", "202.65.111.255"},
{"202.65.160.0", "202.65.175.255"},
{"202.65.192.0", "202.65.223.255"},
{"202.65.248.0", "202.67.3.255"},
{"202.67.128.0", "202.68.63.255"},
{"202.68.96.0", "202.68.127.255"},
{"202.68.192.0", "202.68.207.255"},
{"202.68.252.0", "202.69.3.255"},
{"202.69.64.0", "202.69.95.255"},
{"202.69.128.0", "202.69.131.255"},
{"202.69.240.0", "202.70.31.255"},
{"202.70.160.0", "202.70.175.255"},
{"202.70.240.0", "202.71.31.255"},
{"202.71.192.0", "202.72.31.255"},
{"202.72.252.0", "202.73.3.255"},
{"202.73.128.0", "202.73.131.255"},
{"202.73.240.0", "202.74.3.255"},
{"202.74.80.0", "202.74.127.255"},
{"202.74.254.0", "202.75.3.255"},
{"202.75.64.0", "202.75.95.255"},
{"202.75.252.0", "202.76.127.255"},
{"202.76.252.0", "202.77.63.255"},
{"202.77.128.0", "202.78.7.255"},
{"202.78.192.0", "202.78.207.255"},
{"202.78.252.0", "202.78.255.255"},
{"202.79.252.0", "202.80.31.255"},
{"202.80.192.0", "202.80.207.255"},
{"202.81.0.0", "202.81.3.255"},
{"202.81.224.0", "202.83.15.255"},
{"202.83.192.0", "202.83.207.255"},
{"202.83.252.0", "202.84.17.255"},
{"202.84.64.0", "202.84.79.255"},
{"202.84.128.0", "202.85.207.255"},
{"202.85.224.0", "202.85.239.255"},
{"202.85.248.0", "202.86.3.255"},
{"202.86.64.0", "202.86.95.255"},
{"202.86.252.0", "202.87.3.255"},
{"202.87.252.0", "202.88.31.255"},
{"202.88.96.0", "202.88.127.255"},
{"202.88.200.0", "202.88.207.255"},
{"202.89.0.0", "202.89.3.255"},
{"202.89.252.0", "202.89.255.255"},
{"202.91.224.0", "202.91.255.255"},
{"202.92.160.0", "202.92.175.255"},
{"202.93.192.0", "202.93.207.255"},
{"202.94.224.0", "202.94.239.255"},
{"202.122.64.0", "202.122.95.255"},
{"202.123.64.0", "202.123.95.255"},
{"202.123.160.0", "202.123.175.255"},
{"202.123.192.0", "202.123.223.255"},
{"202.125.192.0", "202.125.255.255"},
{"202.127.64.0", "202.127.79.255"},
{"202.128.128.0", "202.128.159.255"},
{"202.128.224.0", "202.128.255.255"},
{"202.130.64.0", "202.130.191.255"},
{"202.131.32.0", "202.131.47.255"},
{"202.131.64.0", "202.131.79.255"},
{"202.134.64.0", "202.134.127.255"},
{"202.140.64.0", "202.140.127.255"},
{"202.140.160.0", "202.140.175.255"},
{"202.144.224.0", "202.144.255.255"},
{"202.146.96.0", "202.146.127.255"},
{"202.153.96.0", "202.153.127.255"},
{"202.155.192.0", "202.155.223.255"},
{"202.161.160.0", "202.161.175.255"},
{"202.163.0.0", "202.163.31.255"},
{"202.169.0.0", "202.169.15.255"},
{"202.170.0.0", "202.170.31.255"},
{"202.174.128.0", "202.174.159.255"},
{"202.176.224.0", "202.177.39.255"},
{"202.180.128.0", "202.180.175.255"},
{"202.181.32.0", "202.181.63.255"},
{"202.181.128.0", "202.181.255.255"},
{"202.182.224.0", "202.182.255.255"},
{"202.189.96.0", "202.189.127.255"},
{"203.77.128.0", "203.77.159.255"},
{"203.78.5.0", "203.78.7.255"},
{"203.78.32.0", "203.78.47.255"},
{"203.78.64.0", "203.78.95.255"},
{"203.80.0.0", "203.80.3.255"},
{"203.80.64.0", "203.80.131.255"},
{"203.80.192.0", "203.80.255.255"},
{"203.81.252.0", "203.82.1.255"},
{"203.82.252.0", "203.83.3.255"},
{"203.83.64.0", "203.83.127.255"},
{"203.83.252.0", "203.84.63.255"},
{"203.84.128.0", "203.84.129.255"},
{"203.85.0.0", "203.85.255.255"},
{"203.86.128.0", "203.86.191.255"},
{"203.86.252.0", "203.86.255.255"},
{"203.90.224.0", "203.90.255.255"},
{"203.91.128.0", "203.91.159.255"},
{"203.98.128.0", "203.98.191.255"},
{"203.99.128.0", "203.99.191.255"},
{"203.100.64.0", "203.100.95.255"},
{"203.100.128.0", "203.100.159.255"},
{"203.100.192.0", "203.100.207.255"},
{"203.105.0.0", "203.105.63.255"},
{"203.105.96.0", "203.105.127.255"},
{"203.112.80.0", "203.112.95.255"},
{"203.129.64.0", "203.129.95.255"},
{"203.131.224.0", "203.131.255.255"},
{"203.132.192.0", "203.132.207.255"},
{"203.133.128.0", "203.133.159.255"},
{"203.135.128.0", "203.135.159.255"},
{"203.142.96.0", "203.142.127.255"},
{"203.145.64.0", "203.145.95.255"},
{"203.153.64.0", "203.153.79.255"},
{"203.160.32.0", "203.160.47.255"},
{"203.160.64.0", "203.160.95.255"},
{"203.161.224.0", "203.161.255.255"},
{"203.168.128.0", "203.168.255.255"},
{"203.169.32.0", "203.169.47.255"},
{"203.169.128.0", "203.169.255.255"},
{"203.176.128.0", "203.176.191.255"},
{"203.184.128.0", "203.185.63.255"},
{"203.186.0.0", "203.186.255.255"},
{"203.189.160.0", "203.189.175.255"},
{"203.193.0.0", "203.193.127.255"},
{"203.194.128.0", "203.195.95.255"},
{"203.198.0.0", "203.198.255.255"},
{"203.209.128.0", "203.209.143.255"},
{"203.210.0.0", "203.210.15.255"},
{"203.215.240.0", "203.215.255.255"},
{"203.218.0.0", "203.218.255.255"},
{"204.79.169.0", "204.79.169.255"},
{"204.79.182.0", "204.79.183.255"},
{"204.79.189.0", "204.79.189.255"},
{"206.220.132.0", "206.220.135.255"},
{"206.225.128.0", "206.225.131.255"},
{"210.0.128.0", "210.0.255.255"},
{"210.3.0.0", "210.3.255.255"},
{"210.6.0.0", "210.6.255.255"},
{"210.16.224.0", "210.16.239.255"},
{"210.17.128.0", "210.17.191.255"},
{"210.57.0.0", "210.57.207.255"},
{"210.87.248.0", "210.87.255.255"},
{"210.176.0.0", "210.177.255.255"},
{"210.184.0.0", "210.184.255.255"},
{"218.102.0.0", "218.103.255.255"},
{"218.188.0.0", "218.189.255.255"},
{"218.252.0.0", "218.254.255.255"},
{"219.76.0.0", "219.78.255.255"},
{"", ""}},

	
//static char Macao[][2][20]  = {
{{"192.203.232.0", "192.203.232.255"},
{"202.171.252.0", "202.172.3.255"},
{"202.173.0.0", "202.173.3.255"},
{"202.174.0.0", "202.174.3.255"},
{"202.175.0.0", "202.175.127.255"},
{"", ""}},

};


int IPCmp(unsigned long* alIP1, unsigned long* alIP2)
{
	if (alIP1[0] < alIP2[0]) return -1;
	if (alIP1[0] > alIP2[0]) return 1;
	return 0;
}

int IPSCmp(unsigned long* lIP, unsigned long* alIP)
{
	if (*lIP < alIP[0]) return -1;
	if (*lIP > alIP[1]) return 1;
	return 0;
}



int InitAreaIP()
{
int i;

	memset(aiAreaIPTotal, 0, sizeof(aiAreaIPTotal));
	memset(alAreaIP, 0, sizeof(alAreaIP));

	for (i=1; i<=MAX_AREA_ID; ++i)
	{
		while(strlen(asAreaIP[i][aiAreaIPTotal[i]][0])>0)
		{	
			alAreaIP[i][aiAreaIPTotal[i]][0] = inet_network(asAreaIP[i][aiAreaIPTotal[i]][0]);
			alAreaIP[i][aiAreaIPTotal[i]][1] = inet_network(asAreaIP[i][aiAreaIPTotal[i]][1]);
			
			aiAreaIPTotal[i]++;
		}
		qsort(alAreaIP[i], aiAreaIPTotal[i], sizeof(long)*2, (void *)&IPCmp);
		//printf("%d %d\n", i, aiAreaIPTotal[i]);
	}
		

/*	

	iMaxAreaID = 0;

	aiAreaIPTotal[ID_CHINA] = sizeof(asChinaIP) / 40;
	//printf("china ip total =%d\n",aiAreaIPTotal[ID_CHINA]);

	for (iCount = 0; iCount < aiAreaIPTotal[ID_CHINA]; iCount++) {
		alAreaIP[ID_CHINA][iCount][0] = inet_network(asChinaIP[iCount][0]);
		alAreaIP[ID_CHINA][iCount][1] = inet_network(asChinaIP[iCount][1]);
	}
	qsort(alAreaIP[ID_CHINA], aiAreaIPTotal[ID_CHINA], sizeof(long)*2, (void *)&IPCmp);
	if (ID_CHINA > iMaxAreaID) iMaxAreaID = ID_CHINA;
	


    aiAreaIPTotal[ID_JAPAN] = sizeof(asJapanIP) / 40;
    //printf("Japan ip total =%d\n",aiAreaIPTotal[ID_JAPAN]);
	
	for (iCount = 0; iCount < aiAreaIPTotal[ID_JAPAN]; iCount++) {
		alAreaIP[ID_JAPAN][iCount][0] = inet_network(asJapanIP[iCount][0]);
		alAreaIP[ID_JAPAN][iCount][1] = inet_network(asJapanIP[iCount][1]);
	}
	qsort(alAreaIP[ID_JAPAN], aiAreaIPTotal[ID_JAPAN], sizeof(long)*2, (void *)&IPCmp);
	if (ID_JAPAN > iMaxAreaID) iMaxAreaID = ID_JAPAN;



    aiAreaIPTotal[ID_TAIWAN] = sizeof(asTaiwanIP) / 40;
    //printf("Taiwan ip total =%d\n",aiAreaIPTotal[ID_TAIWAN]);
	
	for (iCount = 0; iCount < aiAreaIPTotal[ID_TAIWAN]; iCount++) {
		alAreaIP[ID_TAIWAN][iCount][0] = inet_network(asTaiwanIP[iCount][0]);
		alAreaIP[ID_TAIWAN][iCount][1] = inet_network(asTaiwanIP[iCount][1]);
	}
	qsort(alAreaIP[ID_TAIWAN], aiAreaIPTotal[ID_TAIWAN], sizeof(long)*2, (void *)&IPCmp);
	if (ID_TAIWAN > iMaxAreaID) iMaxAreaID = ID_TAIWAN;
*/

	return 0;
}




int GetAreaID(char* sIP)
{
unsigned long lIP;
int iAreaID;

	if (iAreaIPInit == 0)
	{
		iAreaIPInit = 1;
		InitAreaIP();
	}

	lIP = inet_network(sIP);
	
	for (iAreaID = 1; iAreaID <= MAX_AREA_ID; ++iAreaID)
		if (bsearch(&lIP, &alAreaIP[iAreaID], aiAreaIPTotal[iAreaID], sizeof(long)*2, (void *)&IPSCmp)!=NULL)
			return iAreaID;

	return 0;
}



int IsChinaIP(char* sIP)
{
	if (GetAreaID(sIP) == ID_CHINA)
		return 1;
	
	return 0;
}

int DailyLog(char* sPrefix, char* sFormat, ...)
{
va_list ap;
char sFile[80];
FILE* flog;

	snprintf(sFile, sizeof(sFile) - 1, "%s.%s", sPrefix, CurrDayStr());
	if (!(flog = fopen(sFile, "a+"))) return -1;
	va_start(ap, sFormat);
	fprintf(flog, "[%s] ", CurrDateTimeStr());
	vfprintf(flog, sFormat, ap);
	fprintf(flog, "\n");
	va_end(ap);
	fclose(flog);
	return 0;
}

void *my_bsearch (const void *key, const void *base, size_t nmemb, size_t size, int *piEqual, 
	 int (*compar) (const void *, const void *))
{
	size_t l, u, idx;
	const void *p, *p2;
	int comparison, comparison2;
	
	*piEqual = 0;
	l = 0;
	u = nmemb;
	
	while (l < u)
	{
		idx = (l + u) / 2;
		p = (void *) (((const char *) base) + (idx * size));
		comparison = (*compar) (key, p);
		
		if (comparison == 0)
		{
			*piEqual = 1;
			return (void *) p;
		}		
		else if (comparison < 0)
		{
			if (idx == 0) return (void *) p;
			
			p2 = (void *) (((const char *) base) + ((idx - 1) * size));
			comparison2 = (*compar) (key, p2);
			
			if (comparison2 > 0) return (void *) p;
			
			u = idx;
		}
		else /*if (comparison > 0)*/ 
		{
			l = idx + 1;
		}		
	}
	
	return NULL;
}

int MyBSearch (const void *key, const void *base, size_t nmemb, size_t size, int *piEqual, int (*compar) (const void *, const void *))
{
	size_t l, u, idx;
	const void *p, *p2;
	int comparison, comparison2;
	
	*piEqual = 0;
	if (!nmemb) return 0;
	l = 0;
	u = nmemb;
	
	while (l < u)
	{
		idx = (l + u) / 2;
		p = (void *) (((const char *) base) + (idx * size));
		comparison = (*compar) (key, p);
		
		if (comparison == 0)
		{
			*piEqual = 1;
			return idx;
		}		
		else if (comparison < 0)
		{
			if (idx == 0) return idx;
			
			p2 = (void *) (((const char *) base) + ((idx - 1) * size));
			comparison2 = (*compar) (key, p2);
			
			if (comparison2 > 0) return idx;
			
			u = idx;
		}
		else /*if (comparison > 0)*/ 
		{
			l = idx + 1;
		}		
	}
	
	return u;
}

int MyBInsert (const void *key, const void *base, size_t *pnmemb, size_t size, int iUnique, int (*compar) (const void *, const void *))
{
int i, iInsert, iEqu;

	iInsert = MyBSearch(key, base, *pnmemb, size, &iEqu, compar);
	if (iEqu && iUnique) return 0;
	if (iInsert < *pnmemb)
		for (i = *pnmemb; i > iInsert; i--) memcpy((char *)base + i * size, (char *)base + (i - 1)*size, size);
	memcpy((char *)base + iInsert*size, key, size);
	(*pnmemb)++;
	return 1;
}

int MyIDelete (const void *base, size_t *pnmemb, size_t size, int index)
{
	int i;

	if (0 > index || index >= *pnmemb)
		return 0;

	for (i = index; i < (*pnmemb) - 1; i++) memcpy((char *)base + i * size, (char *)base + (i + 1)*size, size);
	(*pnmemb)--;

	return 1;
}

int MyBDelete (const void *key, const void *base, size_t *pnmemb, size_t size, int (*compar) (const void *, const void *))
{
int i, iDelete, iEqu;

	iDelete = MyBSearch(key, base, *pnmemb, size, &iEqu, compar);
	if (!iEqu) return 0;
	if (iDelete < *pnmemb)
		for (i = iDelete; i < (*pnmemb) - 1; i++) memcpy((char *)base + i * size, (char *)base + (i + 1)*size, size);
	(*pnmemb)--;
	return 1;
}

int CmpModifyTime(char *sFile, time_t *plMTime)
{
struct stat stStat;

	if	(stat(sFile, &stStat) < 0) return 0;
	if (*plMTime == stStat.st_mtime) return 0;
	*plMTime = stStat.st_mtime;
	return 1;
}

void sigterm_handle( int isignal)
{
	g_iTerminate = 1 ;
}

void MySigaction(int sig , SA_HANDLE sighandle)
{
	struct sigaction  myact ;
	
	myact.sa_handler = sighandle ;
	sigemptyset( &myact.sa_mask) ;
     	 myact.sa_flags = 0 ;
	sigaction(sig , &myact , NULL ) ;
	return ;
}
